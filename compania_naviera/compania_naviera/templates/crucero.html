{% extends "base.html" %}
{% load static %}

{% block content %}

<!-- ========== HERO SIMPLE ========== -->
<section class="mx-auto max-w-7xl px-6 lg:px-10 pt-8">
  <div class="rounded-2xl bg-gradient-to-br from-blue-900/70 to-blue-700/40 border border-white/20 p-8 md:p-10 backdrop-blur-xl">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
      <div class="space-y-3">
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/20 text-xs tracking-wider">
          <span class="inline-flex w-5 h-5 items-center justify-center rounded-full bg-white text-blue-900 font-bold">★</span>
          Sea Star · Cruceros
        </div>
        <h1 class="text-3xl md:text-4xl font-extrabold">Encontrá tu crucero ideal</h1>
        <p class="text-white/90 max-w-2xl">
          Filtrá por categoría, precio y duración. Compará y elegí tu próxima aventura en el mar.
        </p>
      </div>
    </div>
  </div>
</section>

<!-- ========== ESTILOS DEL FILTRO (sin burbuja) ========== -->
<style>
  .pill { @apply px-3 py-1.5 rounded-xl bg-white/10 border border-white/20 text-sm hover:bg-white/20 transition flex items-center gap-2; }
  .pill-active { @apply bg-orange-500 border-orange-500 text-white shadow ring-2 ring-orange-300/50; }
  .seg-btn { @apply px-3 py-1.5 text-sm rounded-lg hover:bg-white/20 transition; }
  .seg-active { @apply bg-white/20 text-white ring-1 ring-white/30; }
  .range-wrap { height: 24px; } /* solo espacio vertical del control */
  /* range un poco más visible */
  input[type="range"]::-webkit-slider-runnable-track { height: 6px; border-radius: 999px; }
  input[type="range"]::-webkit-slider-thumb { margin-top: -6px; width: 18px; height: 18px; border-radius: 999px; }
</style>

<!-- ========== BARRA DE FILTROS (sticky desktop) ========== -->
<section class="mx-auto max-w-7xl px-6 lg:px-10 mt-6">
  <div class="mb-2 flex items-center justify-between lg:hidden">
    <span class="text-sm text-white/80">Filtrar resultados</span>
    <button id="toggleFilters" class="px-3 py-1.5 rounded-xl border border-white/20 bg-white/10 hover:bg-white/20 text-sm">
      Mostrar filtros
    </button>
  </div>

  <div id="filterBar"
       class="rounded-2xl bg-white/10 border border-white/20 backdrop-blur-xl p-4 md:p-5 shadow-lg
              lg:sticky lg:top-2">
    <div id="filtersBody" class="grid grid-cols-1 xl:grid-cols-12 gap-3 items-center">
      <!-- Buscar -->
      <div class="xl:col-span-4">
        <label for="q" class="sr-only">Buscar</label>
        <div class="flex items-center gap-2 bg-white/10 border border-white/20 rounded-xl px-3 py-2">
          <i class="fa-solid fa-magnifying-glass text-white/80"></i>
          <input id="q" type="text" placeholder="Buscar por destino, tipo..."
                 class="w-full bg-transparent placeholder-white/60 focus:outline-none" />
        </div>
      </div>

      <!-- Categorías -->
      <div class="xl:col-span-5">
        <div class="flex flex-wrap gap-2" id="catGroup" aria-label="Categorías">
          <button data-cat="familiar"   class="pill"><i class="fa-solid fa-children"></i> Familiar</button>
          <button data-cat="aventura"   class="pill"><i class="fa-solid fa-person-hiking"></i> Aventura</button>
          <button data-cat="lujo"       class="pill"><i class="fa-solid fa-gem"></i> Lujo</button>
          <button data-cat="tematico"   class="pill"><i class="fa-solid fa-masks-theater"></i> Temático</button>
          <button data-cat="naturaleza" class="pill"><i class="fa-solid fa-leaf"></i> Naturaleza</button>
          <button data-cat="cultural"   class="pill"><i class="fa-solid fa-landmark"></i> Cultural</button>
        </div>
      </div>

      <!-- Noches -->
      <div class="xl:col-span-2">
        <div class="flex items-center gap-2">
          <span class="text-sm text-white/80 whitespace-nowrap">Noches</span>
          <div class="flex items-center gap-1">
            <button data-n="all"  class="seg-btn seg-active">Todas</button>
            <button data-n="short" class="seg-btn">≤7</button>
            <button data-n="mid"   class="seg-btn">8–10</button>
            <button data-n="long"  class="seg-btn">11+</button>
          </div>
        </div>
      </div>

      <!-- Precio (sin burbuja) -->
      <div class="xl:col-span-3 grid grid-cols-12 items-center gap-2">
        <label for="price" class="col-span-3 text-sm whitespace-nowrap">Hasta</label>
        <div class="col-span-7 range-wrap">
          <input id="price" type="range" min="600" max="1600" step="50" class="w-full accent-orange-500" />
        </div>
        <div class="col-span-2 text-right text-sm font-semibold text-orange-400" id="priceLabel">USD 1600</div>
      </div>

      <!-- Orden -->
      <div class="xl:col-span-2">
        <label for="sort" class="sr-only">Ordenar</label>
        <select id="sort" class="w-full bg-white/10 border border-white/20 rounded-xl px-2 py-2 text-sm focus:outline-none">
          <option value="relevance">Orden: Recomendado</option>
          <option value="price_asc">Precio: menor a mayor</option>
          <option value="price_desc">Precio: mayor a menor</option>
          <option value="nights_asc">Noches: menor a mayor</option>
          <option value="nights_desc">Noches: mayor a menor</option>
        </select>
      </div>

      <!-- Acciones -->
      <div class="xl:col-span-2 flex gap-2 justify-end">
        <button id="clearFilters" class="px-3 py-2 rounded-xl border border-white/20 bg-white/10 hover:bg-white/20 text-sm">Limpiar</button>
      </div>
    </div>

    <!-- Filtros activos + contador -->
    <div class="mt-3 flex flex-wrap items-center justify-between gap-2">
      <div id="activeChips" class="flex flex-wrap gap-2"></div>
      <div class="text-sm text-white/80"><span id="matchCount">6</span> resultados</div>
    </div>
  </div>
</section>

<!-- ========== GRID DE CRUCEROS ========== -->
<section class="max-w-7xl mx-auto px-6 lg:px-10 py-8">
  <div id="cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">

    <!-- 1) Familiar -->
    <article data-card data-title="Crucero Familiar" data-cat="familiar" data-price="799" data-nights="7" data-dest="Bahamas Cozumel Jamaica"
             class="bg-white/10 rounded-2xl overflow-hidden border border-white/20 hover:border-white/30 transition shadow-xl hover:shadow-2xl">
      <div class="relative">
        <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e" alt="Crucero Familiar" class="w-full h-56 object-cover">
        <div class="absolute inset-0 bg-gradient-to-t from-blue-900/50 via-transparent to-transparent"></div>
        <span class="absolute top-3 left-3 text-xs px-2 py-1 rounded-full bg-black/40">Familiar</span>
      </div>
      <div class="p-6 space-y-3">
        <h3 class="text-xl font-semibold">Crucero Familiar</h3>
        <p class="text-white/80 text-sm">Clubs infantiles y shows para todas las edades.</p>
        <ul class="text-white/75 text-sm space-y-1">
          <li class="flex items-center gap-2"><i class="fa-solid fa-circle-check text-orange-400"></i> 7 noches · Todo incluido</li>
          <li class="flex items-center gap-2"><i class="fa-solid fa-location-dot text-orange-400"></i> Bahamas · Cozumel · Jamaica</li>
        </ul>
        <div class="flex items-center justify-between pt-2">
          <span class="text-orange-400 font-bold">USD 799</span>
          <a href="{% url 'login' %}?next={% url 'cruceros' %}" class="px-4 py-2 rounded-lg bg-orange-500 hover:bg-orange-600 font-medium">Conocer Más</a>
        </div>
      </div>
    </article>

    <!-- 2) Aventura -->
    <article data-card data-title="Crucero de Aventura" data-cat="aventura" data-price="1199" data-nights="10" data-dest="Mediterráneo Roma Mónaco Santorini"
             class="bg-white/10 rounded-2xl overflow-hidden border border-white/20 hover:border-white/30 transition shadow-xl hover:shadow-2xl">
      <div class="relative">
        <img src="{% static 'a2.png' %}" alt="Crucero de Aventura" class="w-full h-56 object-cover">
        <div class="absolute inset-0 bg-gradient-to-t from-blue-900/50 via-transparent to-transparent"></div>
        <span class="absolute top-3 left-3 text-xs px-2 py-1 rounded-full bg-black/40">Aventura</span>
      </div>
      <div class="p-6 space-y-3">
        <h3 class="text-xl font-semibold">Crucero de Aventura</h3>
        <p class="text-white/80 text-sm">Senderismo, snorkel y exploración de islas.</p>
        <ul class="text-white/75 text-sm space-y-1">
          <li class="flex items-center gap-2"><i class="fa-solid fa-circle-check text-orange-400"></i> 10 noches · Outdoor</li>
          <li class="flex items-center gap-2"><i class="fa-solid fa-location-dot text-orange-400"></i> Mediterráneo</li>
        </ul>
        <div class="flex items-center justify-between pt-2">
          <span class="text-orange-400 font-bold">USD 1199</span>
          <a href="{% url 'login' %}?next={% url 'cruceros' %}" class="px-4 py-2 rounded-lg bg-orange-500 hover:bg-orange-600 font-medium">Conocer Más</a>
        </div>
      </div>
    </article>

    <!-- 3) Lujo -->
    <article data-card data-title="Crucero de Lujo" data-cat="lujo" data-price="999" data-nights="5" data-dest="Fiordos Oslo Bergen"
             class="bg-white/10 rounded-2xl overflow-hidden border border-white/20 hover:border-white/30 transition shadow-xl hover:shadow-2xl">
      <div class="relative">
        <img src="{% static 'a5.jpg' %}" alt="Crucero de Lujo" class="w-full h-56 object-cover">
        <div class="absolute inset-0 bg-gradient-to-t from-blue-900/50 via-transparent to-transparent"></div>
        <span class="absolute top-3 left-3 text-xs px-2 py-1 rounded-full bg-black/40">Lujo</span>
      </div>
      <div class="p-6 space-y-3">
        <h3 class="text-xl font-semibold">Crucero de Lujo</h3>
        <p class="text-white/80 text-sm">Suites elegantes, cenas gourmet y spa.</p>
        <ul class="text-white/75 text-sm space-y-1">
          <li class="flex items-center gap-2"><i class="fa-solid fa-circle-check text-orange-400"></i> 5 noches · Premium</li>
          <li class="flex items-center gap-2"><i class="fa-solid fa-location-dot text-orange-400"></i> Fiordos Noruegos</li>
        </ul>
        <div class="flex items-center justify-between pt-2">
          <span class="text-orange-400 font-bold">USD 999</span>
          <a href="{% url 'login' %}?next={% url 'cruceros' %}" class="px-4 py-2 rounded-lg bg-orange-500 hover:bg-orange-600 font-medium">Conocer Más</a>
        </div>
      </div>
    </article>

    <!-- 4) Temático -->
    <article data-card data-title="Crucero Temático" data-cat="tematico" data-price="749" data-nights="6" data-dest="Sudamérica Buenos Aires Punta del Este Río"
             class="bg-white/10 rounded-2xl overflow-hidden border border-white/20 hover:border-white/30 transition shadow-xl hover:shadow-2xl">
      <div class="relative">
        <img src="{% static 'a3.jpg' %}" alt="Crucero Temático" class="w-full h-56 object-cover">
        <div class="absolute inset-0 bg-gradient-to-t from-blue-900/50 via-transparent to-transparent"></div>
        <span class="absolute top-3 left-3 text-xs px-2 py-1 rounded-full bg-black/40">Temático</span>
      </div>
      <div class="p-6 space-y-3">
        <h3 class="text-xl font-semibold">Crucero Temático</h3>
        <p class="text-white/80 text-sm">Música, gastronomía o bienestar, vos elegís.</p>
        <ul class="text-white/75 text-sm space-y-1">
          <li class="flex items-center gap-2"><i class="fa-solid fa-circle-check text-orange-400"></i> 6 noches · Shows & talleres</li>
          <li class="flex items-center gap-2"><i class="fa-solid fa-location-dot text-orange-400"></i> Sudamérica</li>
        </ul>
        <div class="flex items-center justify-between pt-2">
          <span class="text-orange-400 font-bold">USD 749</span>
          <a href="{% url 'login' %}?next={% url 'cruceros' %}" class="px-4 py-2 rounded-lg bg-orange-500 hover:bg-orange-600 font-medium">Conocer Más</a>
        </div>
      </div>
    </article>

    <!-- 5) Naturaleza -->
    <article data-card data-title="Crucero de Naturaleza" data-cat="naturaleza" data-price="1099" data-nights="8" data-dest="Alaska Glaciares Ballenas Parques"
             class="bg-white/10 rounded-2xl overflow-hidden border border-white/20 hover:border-white/30 transition shadow-xl hover:shadow-2xl">
      <div class="relative">
        <img src="{% static 'a1.jpg' %}" alt="Crucero de Naturaleza" class="w-full h-56 object-cover">
        <div class="absolute inset-0 bg-gradient-to-t from-blue-900/50 via-transparent to-transparent"></div>
        <span class="absolute top-3 left-3 text-xs px-2 py-1 rounded-full bg-black/40">Naturaleza</span>
      </div>
      <div class="p-6 space-y-3">
        <h3 class="text-xl font-semibold">Crucero de Naturaleza</h3>
        <p class="text-white/80 text-sm">Glaciares, fauna y parques nacionales.</p>
        <ul class="text-white/75 text-sm space-y-1">
          <li class="flex items-center gap-2"><i class="fa-solid fa-circle-check text-orange-400"></i> 8 noches · Excursiones guiadas</li>
          <li class="flex items-center gap-2"><i class="fa-solid fa-location-dot text-orange-400"></i> Alaska</li>
        </ul>
        <div class="flex items-center justify-between pt-2">
          <span class="text-orange-400 font-bold">USD 1099</span>
          <a href="{% url 'login' %}?next={% url 'cruceros' %}" class="px-4 py-2 rounded-lg bg-orange-500 hover:bg-orange-600 font-medium">Conocer Más</a>
        </div>
      </div>
    </article>

    <!-- 6) Cultural -->
    <article data-card data-title="Crucero Cultural" data-cat="cultural" data-price="1499" data-nights="12" data-dest="Asia Oriental Tokio Shanghái Singapur"
             class="bg-white/10 rounded-2xl overflow-hidden border border-white/20 hover:border-white/30 transition shadow-xl hover:shadow-2xl">
      <div class="relative">
        <img src="{% static 'a4.jpg' %}" alt="Crucero Cultural" class="w-full h-56 object-cover">
        <div class="absolute inset-0 bg-gradient-to-t from-blue-900/50 via-transparent to-transparent"></div>
        <span class="absolute top-3 left-3 text-xs px-2 py-1 rounded-full bg-black/40">Cultural</span>
      </div>
      <div class="p-6 space-y-3">
        <h3 class="text-xl font-semibold">Crucero Cultural</h3>
        <p class="text-white/80 text-sm">Historia, tradiciones y talleres con expertos.</p>
        <ul class="text-white/75 text-sm space-y-1">
          <li class="flex items-center gap-2"><i class="fa-solid fa-circle-check text-orange-400"></i> 12 noches · Circuito deluxe</li>
          <li class="flex items-center gap-2"><i class="fa-solid fa-location-dot text-orange-400"></i> Asia Oriental</li>
        </ul>
        <div class="flex items-center justify-between pt-2">
          <span class="text-orange-400 font-bold">USD 1499</span>
          <a href="{% url 'login' %}?next={% url 'cruceros' %}" class="px-4 py-2 rounded-lg bg-orange-500 hover:bg-orange-600 font-medium">Conocer Más</a>
        </div>
      </div>
    </article>

  </div>
</section>

<!-- ========== JS DEL FILTRADO (sin burbuja) ========== -->
<script>
(function () {
  const $  = (sel, ctx=document) => ctx.querySelector(sel);
  const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

  const maxPrice = 1600;
  const state = { q:"", cats:new Set(), nights:"all", price:maxPrice, sort:"relevance" };

  const cardsWrap   = $("#cards");
  const cards       = $$("#cards [data-card]");
  const inputQ      = $("#q");
  const price       = $("#price");
  const priceLabel  = $("#priceLabel");
  const sortSel     = $("#sort");
  const clearBtn    = $("#clearFilters");
  const catBtns     = $$("#catGroup .pill");
  const segBtns     = $$(".seg-btn");
  const activeChips = $("#activeChips");
  const matchCount  = $("#matchCount");
  const toggleBtn   = $("#toggleFilters");
  const filtersBody = $("#filtersBody");

  function norm(s){ return (s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""); }
  function inNights(n){
    n = Number(n);
    if (state.nights === "all") return true;
    if (state.nights === "short") return n <= 7;
    if (state.nights === "mid")   return n >= 8 && n <= 10;
    if (state.nights === "long")  return n >= 11;
    return true;
  }
  function updatePriceUI(){ priceLabel.textContent = "USD " + state.price; }

  function chip(text, onRemove){
    const el = document.createElement("button");
    el.className = "px-3 py-1.5 rounded-xl bg-white/10 border border-white/20 text-sm flex items-center gap-2 hover:bg-white/20";
    el.innerHTML = `<span>${text}</span><i class="fa-solid fa-xmark text-white/80"></i>`;
    el.addEventListener("click", onRemove);
    activeChips.appendChild(el);
  }
  function renderChips(){
    activeChips.innerHTML = "";
    if (state.q.trim()){ chip("Búsqueda: " + state.q, () => { state.q=""; inputQ.value=""; apply(); }); }
    state.cats.forEach(c => {
      const map = {familiar:"Familiar", aventura:"Aventura", lujo:"Lujo", tematico:"Temático", naturaleza:"Naturaleza", cultural:"Cultural"};
      chip(map[c]||c, () => {
        state.cats.delete(c);
        const btn = catBtns.find(b => b.dataset.cat === c);
        if (btn) btn.classList.remove("pill-active");
        apply();
      });
    });
    if (state.nights!=="all"){
      const map = {short:"≤7 noches", mid:"8–10 noches", long:"11+ noches"};
      chip(map[state.nights], () => {
        state.nights="all";
        segBtns.forEach(b=>b.classList.remove("seg-active"));
        segBtns[0].classList.add("seg-active");
        apply();
      });
    }
    if (state.price<maxPrice){
      chip("≤ USD " + state.price, () => { state.price=maxPrice; price.value=maxPrice; updatePriceUI(); apply(); });
    }
  }

  function apply(){
    const q = norm(state.q);
    let visible = [];
    cards.forEach(card => {
      const title = norm(card.dataset.title);
      const dest  = norm(card.dataset.dest);
      const cat   = norm(card.dataset.cat);
      const p     = Number(card.dataset.price);
      const n     = Number(card.dataset.nights);
      const show  = (!q || title.includes(q) || dest.includes(q))
                 && (state.cats.size===0 || state.cats.has(cat))
                 && (p <= state.price)
                 && inNights(n);
      card.classList.toggle("hidden", !show);
      if (show) visible.push(card);
    });

    matchCount.textContent = visible.length;

    if (state.sort!=="relevance"){
      const s = {
        price_asc:(a,b)=>a.dataset.price - b.dataset.price,
        price_desc:(a,b)=>b.dataset.price - a.dataset.price,
        nights_asc:(a,b)=>a.dataset.nights - b.dataset.nights,
        nights_desc:(a,b)=>b.dataset.nights - a.dataset.nights,
      }[state.sort];
      if (s){
        const hidden = cards.filter(c=>c.classList.contains("hidden"));
        visible.sort(s).forEach(c=>cardsWrap.appendChild(c));
        hidden.forEach(c=>cardsWrap.appendChild(c));
      }
    }
    renderChips();
  }

  // Eventos
  inputQ.addEventListener("input", e => { state.q = e.target.value; apply(); });
  price.addEventListener("input", e => { state.price = Number(e.target.value); updatePriceUI(); apply(); });
  sortSel.addEventListener("change", e => { state.sort = e.target.value; apply(); });
  clearBtn.addEventListener("click", () => {
    state.q=""; state.cats.clear(); state.nights="all"; state.price=maxPrice; state.sort="relevance";
    inputQ.value=""; price.value=maxPrice; updatePriceUI(); sortSel.value="relevance";
    catBtns.forEach(b=>b.classList.remove("pill-active"));
    segBtns.forEach(b=>b.classList.remove("seg-active")); segBtns[0].classList.add("seg-active");
    apply();
  });

  catBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      const key = btn.dataset.cat;
      if (state.cats.has(key)){ state.cats.delete(key); btn.classList.remove("pill-active"); }
      else { state.cats.add(key); btn.classList.add("pill-active"); }
      apply();
    });
  });
  segBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      segBtns.forEach(b=>b.classList.remove("seg-active"));
      btn.classList.add("seg-active");
      state.nights = btn.dataset.n;
      apply();
    });
  });

  // Toggle filtros (mobile)
  const mqDesktop = window.matchMedia("(min-width: 1024px)");
  if (toggleBtn) {
    let open = false;
    const setBody = () => { filtersBody.style.display = (mqDesktop.matches || open) ? "grid" : "none"; };
    const updateText = () => toggleBtn.textContent = open ? "Ocultar filtros" : "Mostrar filtros";
    updateText(); setBody();
    toggleBtn.addEventListener("click", () => { open = !open; setBody(); updateText(); });
    window.addEventListener("resize", setBody);
  }

  updatePriceUI();
  apply();
})();
</script>

{% endblock %}
